-extends 'smartmin/form.html'

-load compress temba smartmin i18n

-block form-span

-block title-text
  .title-text
    %h1
      -trans "Natural Language Understand Service"

-block summary
  -if api_name
    -trans "Connected to NLU Service"
    <b>{{api_name}}</b>.
  -else
    -trans "Connect your NLU Service"

-block pre-form
  -if not api_name
    -blocktrans
      Connecting a Natural Language Understanding service allows you to get entities and intents from contacts messages.
    %hr

-block fields
  {{ block.super }}

  -if api_name
    %button{class: 'btn btn-add-token'}
      -trans "Add token"

  -if extra_tokens
    %p
      %table{class: "table"}
        %tbody
          %tr
            %th
              -trans "Name"
            %th
              -trans "Token"
            %th
              -trans "Action"

        -for extra in extra_tokens
          %tr
            %td
              {{extra.name}}
            %td
              {{extra.token}}
            %td
              %a{href:'{% url "orgs.org_nlu_api" %}?delete_extra=true&token={{extra.token}}'}
                -trans "Delete"

-block form-buttons

-block post-form
  -if api_name
    %p
      -trans "Your NLU Service is connected"
      %b
        {{api_name}}.

    %p
      -trans "If you no longer want it connected, you can"
      %a{href:'javascript:confirmNluApiDisconnect();'}
        %b
          -trans "disconnect"

      -trans "your NLU Service."
      %p
        %b
          -trans "Doing so will interrupt flows that use NLU."

    .disconnect-nlu-api.hide
      .title
        -trans "Disconnect NLU Service"
      .body
        -blocktrans
          This will disconnect your NLU Service. Are you sure you want to proceed?
    %a#disconnect-nlu-api-form.posterize{href:'{% url "orgs.org_nlu_api" %}?disconnect=true'}

-block extra-script
  :javascript
    $(document).ready(function() {
      select2div('#id_api_name');

      if($('#id_api_name').val() != ""){
        $('.field_api_name').eq(0).hide()

        if($('#id_api_name').val() == 'WIT')
          $('.field_name_bot').eq(0).show()
        else
          $('.field_name_bot').eq(0).hide()
      }

      $('#id_api_name').change(() => {
        if($('#id_api_name').val() == 'WIT')
          $('.field_name_bot').eq(0).show()
        else
          $('.field_name_bot').eq(0).hide()
      });

    });
    function confirmNluApiDisconnect() {
      removalConfirmation("disconnect-nlu-api", "Disconnect");
    }

-block extra-style
  :css
    .btn-add-token {
      margin: 0 0 10px 0;
    }